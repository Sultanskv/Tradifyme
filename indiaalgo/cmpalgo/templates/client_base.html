{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Tradify</title>
  <style>
    body {
      background-color: #f8f9fa;
      color: #333;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
    }

    .navbar-custom {
      background-color: #007bff;
      padding: 10px 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .navbar-custom .navbar-brand {
      font-size: 24px;
      font-weight: bold;
      color: #fff;
      margin-right: 20px;
    }

    .navbar-custom .navbar-nav {
      display: flex;
      align-items: center;
      justify-content: right;
      flex-grow: 1;
      flex-wrap: wrap;
    }

    .navbar-custom .navbar-nav .nav-item {
      margin-right: 15px;
      margin-bottom: 5px;
    }

    .navbar-custom .navbar-nav .nav-link {
      color: #fff;
      font-size: 10px;
      padding: 10px 15px;
      border-radius: 5px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .navbar-custom .navbar-nav .nav-link:hover {
      background-color: #0056b3;
      color: #fff;
      transform: translateY(-2px);
    }

    .navbar-custom .navbar-nav .nav-link i {
      margin-right: 8px;
      font-size: 12px;
    }

    .navbar-custom .btn {
      border-radius: 20px;
      padding: 6px 12px;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .navbar-custom .btn.on {
      background-color: #28a745; /* Green for ON state */
      color: #fff;
    }

    .navbar-custom .btn.off {
      background-color: #dc3545; /* Red for OFF state */
      color: #fff;
    }

    .navbar-custom .btn.on:hover {
      background-color: #218838; /* Darker green for hover */
      color: #fff;
    }

    .navbar-custom .btn.off:hover {
      background-color: #c82333; /* Darker red for hover */
      color: #fff;
    }

    .navbar-custom .navbar-toggler {
      border: none;
      background-color: #ffc107;
      padding: 10px 15px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .navbar-custom .navbar-toggler i {
      color: #333;
      font-size: 24px;
    }

    .navbar-custom .navbar-toggler:hover {
      background-color: #e0a800;
    }

    /* New additions for notification and profile icons */
    .navbar-custom .navbar-center-icons {
      display: flex;
      align-items: center;
      margin-left: auto;
      flex-wrap: nowrap;
    }

    .navbar-custom .navbar-center-icons .nav-item {
      margin-right: 10px;
    }

    .navbar-custom .navbar-center-icons .nav-link {
      font-size: 12px;
      color: #fff;
      transition: color 0.3s ease;
    }

    .navbar-custom .navbar-center-icons .nav-link:hover {
      color: #ffc107;
    }

    /* Responsive adjustments */
    @media (max-width: 992px) {
      .navbar-custom {
        padding: 10px;
      }

      .navbar-custom .navbar-nav {
        flex-direction: column;
        align-items: flex-start;
        background-color: #007bff;
        border-radius: 10px;
        width: 100%;
        display: none;
        margin-top: 10px;
        padding: 10px;
      }

      .navbar-custom .navbar-nav .nav-item {
        margin-right: 0;
        margin-bottom: 10px;
        width: 100%;
        text-align: left;
      }

      .navbar-custom .navbar-nav .nav-link {
        font-size: 16px;
        padding: 12px 15px;
      }

      .navbar-custom .navbar-nav.show {
        display: flex;
      }

      .navbar-custom .navbar-center-icons {
        margin-top: 10px;
        justify-content: flex-start;
      }

      .navbar-custom .navbar-toggler {
        margin-left: auto;
      }
    }

    @media (max-width: 576px) {
      .navbar-custom .navbar-nav .nav-link {
        font-size: 14px;
        padding: 10px;
      }

      .navbar-custom .navbar-toggler {
        padding: 8px 12px;
      }

      .navbar-custom .navbar-toggler i {
        font-size: 20px;
      }

      .navbar-custom .navbar-center-icons {
        margin-top: 5px;
      }
    }

    /* Profile slide panel */
    .profile-slide {
      position: fixed;
      top: 0;
      right: -100%;
      width: 300px;
      height: 100%;
      background-color: #f0f4f7;
      color: #333;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      z-index: 1050;
      transition: right 0.3s ease;
      overflow-y: auto;
      padding: 20px;
    }

    .profile-slide.open {
      right: 0;
    }

    .profile-slide .close-slide {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #333;
      transition: color 0.3s ease;
    }

    .profile-slide .close-slide:hover {
      color: #ff0000;
    }

    .profile-slide .profile-content {
      padding: 20px;
    }

    .profile-slide .profile-content img {
      border: 3px solid #007bff;
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.5);
    }

    .profile-slide .profile-content h5 {
      font-size: 22px;
      margin-bottom: 20px;
      text-align: center;
      color: #007bff;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
      font-weight: bold;
    }

    .profile-slide .profile-content p {
      font-size: 16px;
      margin-bottom: 15px;
      color: #555;
    }

    .profile-slide .profile-content p strong {
      color: #333;
    }

    .profile-slide .profile-content .btn {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      border-radius: 50px;
      font-size: 16px;
      transition: background-color 0.3s, color 0.3s;
    }

    .profile-slide .profile-content .btn-warning {
      background-color: #ffc107;
      color: #fff;
      border: none;
    }

    .profile-slide .profile-content .btn-warning:hover {
      background-color: #e0a800;
    }

    .profile-slide .profile-content .btn-danger {
      background-color: #dc3545;
      color: #fff;
      border: none;
    }

    .profile-slide .profile-content .btn-danger:hover {
      background-color: #c82333;
    }

    .profile-slide .profile-content .text-monospace {
      font-family: "Courier New", Courier, monospace;
      background-color: #f1f1f1;
      padding: 5px;
      border-radius: 3px;
      display: inline-block;
      word-break: break-all;
    }

    /* Notification popup design */
    .notification-popup {
      position: absolute;
      top: 60px;
      right: 10px;
      width: 300px;
      background-color: #ffffff;
      border: 1px solid #007bff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 1050;
    }

    .notification-popup .popup-header {
      padding: 10px;
      background-color: #007bff;
      color: #fff;
      font-weight: bold;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      text-align: center;
    }

    .notification-popup .popup-body {
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
    }

    .notification-popup .popup-body p {
      margin: 0;
      padding: 8px;
      border-bottom: 1px solid #e0e0e0;
      transition: background-color 0.3s ease;
    }

    .notification-popup .popup-body p:hover {
      background-color: #f0f0f0;
    }

    .mobile-sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 80%;
      height: 100%;
      background-color: #ffffff;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      transition: left 0.3s ease;
      z-index: 1050;
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
    }

    .mobile-sidebar.open {
      left: 0;
    }

    .mobile-sidebar .nav-item {
      margin-bottom: 15px;
    }

    .mobile-sidebar .nav-link {
      color: #007bff;
      font-size: 18px;
      padding: 10px;
      border-radius: 5px;
      text-align: left;
      display: flex;
      align-items: center;
    }

    .mobile-sidebar .nav-link i {
      margin-right: 10px;
    }

    .mobile-sidebar .nav-link:hover {
      background-color: #007bff;
      color: #ffffff;
    }

    .mobile-sidebar .nav-item:last-child {
      margin-bottom: 0;
    }

    .mobile-sidebar .btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 50px;
      transition: all 0.3s ease;
      text-align: center;
      width: 100%;
    }

    .mobile-sidebar .btn.on {
      background-color: #28a745; /* Green for ON state */
      color: #fff;
    }

    .mobile-sidebar .btn.off {
      background-color: #dc3545; /* Red for OFF state */
      color: #fff;
    }

    .mobile-sidebar .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .navbar-brand {
  display: flex;
  align-items: center;
  text-decoration: none;
}

.logo {
  width: 40px; /* Adjust the size as needed */
  height: 40px; /* Adjust the size as needed */
  margin-right: 10px;
  animation: logoSpin 3s infinite linear;
}

.brand-text {
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  position: relative;
  overflow: hidden;
  animation: textFadeIn 2s ease-in-out;
}

.brand-text::before,
.brand-text::after {
  content: '';
  position: absolute;
  width: 100%;
  height: 2px;
  background-color: #ffc107;
  top: 50%;
  left: 0;
  transform: translateY(-50%);
  animation: lineMove 2s infinite ease-in-out;
}

.brand-text::after {
  height: 100%;
  top: 0;
  transform: scaleX(0);
  background: rgba(255, 193, 7, 0.5);
  transition: transform 0.3s ease;
}

.navbar-brand:hover .brand-text::after {
  transform: scaleX(1);
}

@keyframes logoSpin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes textFadeIn {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes lineMove {
  0%,
  100% {
    left: 0;
    right: auto;
    width: 0%;
  }
  50% {
    left: auto;
    right: 0;
    width: 100%;
  }
}
  </style>
</head>

<body>

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12 p-2">
        <div class="container-fluid p-2">
          <nav class="navbar navbar-expand-lg navbar-custom">
            <a class="navbar-brand" href="#">Tradifyme</a>
            <button class="navbar-toggler" type="button" onclick="toggleNavbar()">
              <i class="fa fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav mx-auto">
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'client_dashbord' %}">
                    <i class="fa-solid fa-sliders-h"></i> Panel
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'trade_list' %}">
                    <i class="fa-solid fa-signal"></i> Signals
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'client_trade_history' %}">
                    <i class="fa-solid fa-history"></i> P&L
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'fetch_and_display_orders' %}">
                    <i class="fa-brands fa-first-order-alt"></i> Broker Response
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'client_status' %}">
                    <i class="fa-solid fa-chart-line"></i> Status
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'client_help_center' %}">
                    <i class="fa-solid fa-headset"></i> Support
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'homes' %}">
                    <i class="fa-solid fa-home"></i> Home
                  </a>
                </li>
              </ul>
              <ul class="navbar-center-icons">
                <li class="nav-item">
                  <a class="nav-link" href="#" id="notificationIcon"><i class="fa-solid fa-bell"></i></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#" id="profileIcon"><i class="fa-solid fa-user-circle"></i></a>
                </li>
              </ul>
              <button class="btn" id="brokerConnectButton">API Connect</button>
            </div>
          </nav>

          <!-- Notification Popup -->
          <div class="notification-popup" id="notificationPopup">
            <div class="popup-header">Notifications</div>
            <div class="popup-body" id="notificationBody">
              <p>No new notifications.</p>
            </div>
          </div>

          <!-- TradingView Widget BEGIN -->
          <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright">
              <a href="https://in.tradingview.com/" rel="noopener nofollow" target="_blank"></a>
            </div>
            <script type="text/javascript"
              src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
              {
                "symbols": [
                  {
                    "description": "",
                    "proName": "BSE:SENSEX"
                  },
                  {
                    "description": "",
                    "proName": "AMEX:SPY"
                  },
                  {
                    "description": "",
                    "proName": "BIST:XAUUSD1!"
                  },
                  {
                    "description": "",
                    "proName": "TVC:USOIL"
                  },
                  {
                    "description": "",
                    "proName": "LSE:NASD"
                  }
                ],
                "showSymbolLogo": true,
                "isTransparent": false,
                "displayMode": "adaptive",
                "colorTheme": "Light",
                "locale": "in"
              }
            </script>
          </div>
          <!-- TradingView Widget END -->

          <div class="card shadow card-custom fade-in" style="min-height: 89vh">
            <div class="card-body">
              {% block main %}
              {% endblock %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="profile-slide" id="profileSlide">
    <span class="close-slide" id="closeSlide">&times;</span>
    <div class="profile-content">
      <div class="text-center mb-4">
        <img src="{% static 'pic.png' %}" class="rounded-circle" alt="User Avatar" width="100" height="100">
      </div>
      <h5 class="modal-title text-center mb-3">Profile</h5>
      <p><strong>Name:</strong> {{ client_user.clint_name_first }} {{client_user.clint_name_last}}</p>
      <p><strong>Email:</strong> {{ client_user.clint_email }}</p>
      <p><strong>Mobile:</strong> {{ client_user.clint_phone_number }}</p>
      <p><strong>Broker:</strong> {{ client_user.broker }}</p>
      <p><strong>API Key:</strong> <span class="text-monospace">{{ client_user.api_key }}</span></p>
      <div class="d-flex justify-content-between mt-4">
        <a href="#" class="btn btn-warning btn-block mr-2">Change Password</a>
        <a href="{% url 'client_logout' %}" class="btn btn-danger btn-block ml-2">Logout</a>
      </div>
    </div>
  </div>

  <!-- Mobile Sidebar -->
  <div class="mobile-sidebar" id="mobileSidebar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="{% url 'client_dashbord' %}">
          <i class="fa-solid fa-sliders-h"></i> Panel
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'trade_list' %}">
          <i class="fa-solid fa-signal"></i> Signals
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'client_trade_history' %}">
          <i class="fa-solid fa-history"></i> P&L
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'fetch_and_display_orders' %}">
          <i class="fa-brands fa-first-order-alt"></i> Broker Response
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'client_status' %}">
          <i class="fa-solid fa-chart-line"></i> Status
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'client_help_center' %}">
          <i class="fa-solid fa-headset"></i> Support
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'homes' %}">
          <i class="fa-solid fa-home"></i> Home
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" id="mobileNotificationIcon"><i class="fa-solid fa-bell"></i> Notifications</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" id="mobileProfileIcon"><i class="fa-solid fa-user-circle"></i> Profile</a>
      </li>
    </ul>
    <button class="btn" id="mobileBrokerConnectButton">API Connect</button>
  </div>

  <!-- Include jQuery and Bootstrap JavaScript in the correct order -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+AiZK9Ll7/2hb7U6ka5c2e1uP4hL9F/l/71N1UnK27+q2MfRTO" crossorigin="anonymous">
  </script>
  <script>
function toggleNavbar() {
  var sidebar = document.getElementById('mobileSidebar');
  if (sidebar.classList.contains('open')) {
    sidebar.classList.remove('open');
  } else {
    sidebar.classList.add('open');
  }
}

document.addEventListener('DOMContentLoaded', (event) => {
  const button = document.getElementById('brokerConnectButton');
  const mobileButton = document.getElementById('mobileBrokerConnectButton');

  if (localStorage.getItem('apiConnect') === 'on') {
    button.classList.add('on');
    button.classList.remove('off');
    mobileButton.classList.add('on');
    mobileButton.classList.remove('off');
  } else {
    button.classList.add('off');
    button.classList.remove('on');
    mobileButton.classList.add('off');
    mobileButton.classList.remove('on');
  }

  button.addEventListener('click', function () {
    handleBrokerConnect(button);
  });

  mobileButton.addEventListener('click', function () {
    handleBrokerConnect(mobileButton);
  });

  function handleBrokerConnect(button) {
    if (localStorage.getItem('apiConnect') === 'on') {
      localStorage.setItem('apiConnect', 'off');
      button.classList.add('off');
      button.classList.remove('on');
      window.location.href = "{% url 'off' %}";
    } else {
      localStorage.setItem('apiConnect', 'on');
      button.classList.add('on');
      button.classList.remove('off');
      window.location.href = "{% url 'redirect_to_smartapi_login' %}";
    }
  }

  window.addEventListener('storage', function () {
    if (localStorage.getItem('apiConnect') === 'on') {
      button.classList.add('on');
      button.classList.remove('off');
      mobileButton.classList.add('on');
      mobileButton.classList.remove('off');
    } else {
      button.classList.add('off');
      button.classList.remove('on');
      mobileButton.classList.add('off');
      mobileButton.classList.remove('on');
    }
  });

  const notificationIcon = document.getElementById('notificationIcon');
  const notificationPopup = document.getElementById('notificationPopup');

  notificationIcon.addEventListener('click', function (event) {
    event.stopPropagation();
    closeAllPopups();
    notificationPopup.style.display = notificationPopup.style.display === 'block' ? 'none' : 'block';
  });

  const profileIcon = document.getElementById('profileIcon');
  const profileSlide = document.getElementById('profileSlide');
  const closeSlide = document.getElementById('closeSlide');

  profileIcon.addEventListener('click', function (event) {
    event.stopPropagation();
    closeAllPopups();
    profileSlide.classList.add('open');
  });

  closeSlide.addEventListener('click', function () {
    profileSlide.classList.remove('open');
  });

  const mobileNotificationIcon = document.getElementById('mobileNotificationIcon');
  mobileNotificationIcon.addEventListener('click', function (event) {
    event.stopPropagation();
    toggleNavbar();
    closeAllPopups();
    notificationPopup.style.display = notificationPopup.style.display === 'block' ? 'none' : 'block';
  });

  const mobileProfileIcon = document.getElementById('mobileProfileIcon');
  mobileProfileIcon.addEventListener('click', function (event) {
    event.stopPropagation();
    toggleNavbar();
    closeAllPopups();
    profileSlide.classList.add('open');
  });

  document.addEventListener('click', function () {
    closeAllPopups();
  });

  function closeAllPopups() {
    notificationPopup.style.display = 'none';
    profileSlide.classList.remove('open');
  }
});

  </script>
</body>

</html>
