{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Tradify</title>
  <style>
    body {
      background-color: #ffffff;
      color: #0095ff;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
      text-align: center;
    }

    .navbar-custom {
      background-color: #ffffff;
      padding: 10px 20px;
      box-shadow: 0 4px 8px rgba(255, 255, 255, 0.3);
      height: auto;
      position: relative;
      z-index: 1000;
    }

    .navbar-custom .navbar-brand {
      max-height: 50px;
      margin-right: 15px;
    }

    .navbar-custom .navbar-nav .nav-item {
      margin-right: 10px;
    }

    .navbar-custom .navbar-nav .nav-link {
      color: #007bff;
      font-size: 16px;
      padding: 8px 12px;
      transition: all 0.3s ease;
      border-radius: 3px;
      display: flex;
      align-items: center;
    }

    .navbar-custom .navbar-nav .nav-link i {
      font-size: 20px;
      color: #0073ff;
      margin-right: 5px;
      transition: transform 0.3s ease;
    }

    .navbar-custom .navbar-nav .nav-link:hover,
    .navbar-custom .nav-item.active .nav-link {
      color: #006aff;
      background-color: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 115, 255, 0.5);
      transform: translateY(-2px);
    }

    .navbar-custom .navbar-nav .nav-link:hover i {
      transform: scale(1.2);
    }

    .navbar-custom .btn {
      background-color: #0080ff;
      color: #ffffff;
      border-radius: 20px;
      padding: 8px 16px;
      font-weight: bold;
      margin-left: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .navbar-custom .btn.on {
      background-color: #28a745; /* Green for ON state */
      color: #ffffff;
    }

    .navbar-custom .btn.off {
      background-color: #dc3545; /* Red for OFF state */
      color: #ffffff;
    }

    .navbar-custom .btn:hover {
      background-color: #0073e6;
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.5);
      transform: translateY(-2px);
    }

    /* Burger menu */
    .burger-menu {
      display: none;
      position: absolute;
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      background-color: #ffffff;
      color: #037dff;
      border-radius: 5px;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(5, 147, 255, 0.5);
    }

    .burger-menu i {
      font-size: 24px;
    }

    /* Mobile sidebar */
    .mobile-sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 80%;
      height: 100%;
      background-color: #ffffff;
      box-shadow: 2px 0 10px rgba(10, 108, 255, 0.5);
      transition: left 0.3s ease;
      z-index: 1002;
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
    }

    .mobile-sidebar.open {
      left: 0;
    }

    .mobile-sidebar .nav-item {
      margin-bottom: 20px;
    }

    .mobile-sidebar .nav-link {
      color: #0088ff;
      font-size: 20px;
      padding: 10px;
      border-radius: 5px;
      text-align: left;
      display: flex;
      align-items: center;
    }

    .mobile-sidebar .nav-link i {
      margin-right: 10px;
    }

    .mobile-sidebar .nav-link:hover {
      background-color: #ffffff;
      color: #1251ff;
    }

    @media (max-width: 768px) {
      .navbar-custom .navbar-nav {
        display: none;
      }

      .burger-menu {
        display: flex;
      }
    }

/* Sliding Profile Panel */
.profile-slide {
    position: fixed;
    top: 0;
    right: -100%;
    width: 350px;
    height: 100%;
    background-color: #f8f9fa;
    color: #333;
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
    z-index: 1050;
    transition: right 0.3s ease;
    overflow-y: auto;
    border-radius: 10px 0 0 10px;
}

.profile-slide.open {
    right: 0;
}

.profile-slide .close-slide {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 24px;
    cursor: pointer;
    color: #333;
    transition: color 0.3s ease;
}

.profile-slide .close-slide:hover {
    color: #ff0000;
}

.profile-slide .profile-content {
    padding: 20px;
}

.profile-slide .profile-content img {
    border: 3px solid #007bff;
    box-shadow: 0 4px 8px rgba(0, 123, 255, 0.5);
}

.profile-slide .profile-content h5 {
    font-size: 24px;
    margin-bottom: 20px;
    text-align: center;
    color: #007bff;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
    font-weight: bold;
}

.profile-slide .profile-content p {
    font-size: 18px;
    margin-bottom: 15px;
    color: #555;
}

.profile-slide .profile-content p strong {
    color: #333;
}

.profile-slide .profile-content .btn {
    display: block;
    width: 100%;
    margin-bottom: 15px;
    border-radius: 50px;
    font-size: 18px;
    transition: background-color 0.3s, color 0.3s;
}

.profile-slide .profile-content .btn-warning {
    background-color: #ffc107;
    color: #fff;
    border: none;
}

.profile-slide .profile-content .btn-warning:hover {
    background-color: #e0a800;
}

.profile-slide .profile-content .btn-danger {
    background-color: #dc3545;
    color: #fff;
    border: none;
}

.profile-slide .profile-content .btn-danger:hover {
    background-color: #c82333;
}

.profile-slide .profile-content .text-monospace {
    font-family: "Courier New", Courier, monospace;
    background-color: #f1f1f1;
    padding: 5px;
    border-radius: 3px;
    display: inline-block;
    word-break: break-all;
}
    .notification-popup {
      position: absolute;
      top: 70px;
      right: 20px;
      width: 300px;
      background-color: #fffdfd;
      border: 1px solid #0084ff;
      box-shadow: 0 0 10px rgba(9, 148, 255, 0.5);
      display: none;
      z-index: 1000;
      animation: slideIn 0.5s ease-out;
    }

    .notification-popup .popup-header {
      padding: 10px;
      background-color: #ffffff;
      color: #006bf6;
      font-weight: bold;
      text-align: center;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
    }

    .notification-popup .popup-body {
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
    }

    .notification-popup .popup-body p {
      margin: 0;
      padding: 10px;
      border-bottom: 1px solid #0066ff;
      transition: background-color 0.3s ease;
    }

    .notification-popup .popup-body p:last-child {
      border-bottom: none;
    }

    .notification-popup .popup-body p:hover {
      background-color: #ffffff;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* Adjust for mobile view */
@media (max-width: 768px) {
    .navbar-custom .navbar-nav {
        display: none;
    }

    .burger-menu {
        display: flex;
    }

    .navbar-center-icons {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
    }

    .navbar-center-icons .nav-item {
        margin-right: 15px;
    }

    .navbar-center-icons .nav-item:last-child {
        margin-right: 0;
    }
}
/* Default desktop view settings */
.navbar-center-icons {
    display: flex;
    align-items: center;
    margin-left: auto;
}
.navbar-custom .nav-link i {
    font-size: 24px;
    transition: all 0.3s ease;
    position: relative;
    color: #fff;
}

/* 3D Effect with shadows for each icon */
.navbar-custom .nav-link i.fa-sliders-h {
    color: #ff5733;
    text-shadow: 0px 5px 10px rgba(255, 87, 51, 0.5);
}

.navbar-custom .nav-link i.fa-signal {
    color: #28a745;
    text-shadow: 0px 5px 10px rgba(40, 167, 69, 0.5);
}

.navbar-custom .nav-link i.fa-history {
    color: #ffc107;
    text-shadow: 0px 5px 10px rgba(255, 193, 7, 0.5);
}

.navbar-custom .nav-link i.fa-first-order-alt {
    color: #007bff;
    text-shadow: 0px 5px 10px rgba(0, 123, 255, 0.5);
}

.navbar-custom .nav-link i.fa-chart-line {
    color: #6610f2;
    text-shadow: 0px 5px 10px rgba(102, 16, 242, 0.5);
}

.navbar-custom .nav-link i.fa-headset {
    color: #dc3545;
    text-shadow: 0px 5px 10px rgba(220, 53, 69, 0.5);
}

.navbar-custom .nav-link i.fa-home {
    color: #17a2b8;
    text-shadow: 0px 5px 10px rgba(23, 162, 184, 0.5);
}

.navbar-custom .nav-link i.fa-bell {
    color: #ff6347;
    text-shadow: 0px 5px 10px rgba(255, 99, 71, 0.5);
}

.navbar-custom .nav-link i.fa-user-circle {
    color: #20c997;
    text-shadow: 0px 5px 10px rgba(32, 201, 151, 0.5);
}

/* Hover animations for 3D effect */
.navbar-custom .nav-link i:hover {
    transform: translateY(-5px) scale(1.2);
    text-shadow: 0px 8px 15px rgba(0, 0, 0, 0.5);
}

/* Extra animations for specific icons */
.navbar-custom .nav-link i.fa-bell:hover {
    animation: shake 0.5s ease-in-out;
}

.navbar-custom .nav-link i.fa-user-circle:hover {
    animation: spin 0.8s ease-in-out;
}

/* Shake animation for bell icon */
@keyframes shake {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(-15deg); }
    50% { transform: rotate(15deg); }
    75% { transform: rotate(-15deg); }
    100% { transform: rotate(0deg); }
}

/* Spin animation for profile icon */
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Custom glow effect for all icons on hover */
.navbar-custom .nav-link i:hover {
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
}

/* Mobile Sidebar 3D and Animated Icons */
.mobile-sidebar .nav-link i {
    font-size: 22px;
    transition: all 0.3s ease;
    position: relative;
    color: #fff;
}

/* Specific colors and 3D effects for each icon */
.mobile-sidebar .nav-link i.fa-sliders-h {
    color: #ff5733;
    text-shadow: 0px 4px 8px rgba(255, 87, 51, 0.5);
}

.mobile-sidebar .nav-link i.fa-signal {
    color: #28a745;
    text-shadow: 0px 4px 8px rgba(40, 167, 69, 0.5);
}

.mobile-sidebar .nav-link i.fa-history {
    color: #ffc107;
    text-shadow: 0px 4px 8px rgba(255, 193, 7, 0.5);
}

.mobile-sidebar .nav-link i.fa-first-order-alt {
    color: #007bff;
    text-shadow: 0px 4px 8px rgba(0, 123, 255, 0.5);
}

.mobile-sidebar .nav-link i.fa-chart-line {
    color: #6610f2;
    text-shadow: 0px 4px 8px rgba(102, 16, 242, 0.5);
}

.mobile-sidebar .nav-link i.fa-headset {
    color: #dc3545;
    text-shadow: 0px 4px 8px rgba(220, 53, 69, 0.5);
}

.mobile-sidebar .nav-link i.fa-home {
    color: #17a2b8;
    text-shadow: 0px 4px 8px rgba(23, 162, 184, 0.5);
}

/* Hover animations for icons in the mobile sidebar */
.mobile-sidebar .nav-link i:hover {
    transform: translateY(-5px) scale(1.2);
    text-shadow: 0px 8px 15px rgba(0, 0, 0, 0.5);
}

/* Additional animations */
.mobile-sidebar .nav-link i.fa-bell:hover {
    animation: shake 0.5s ease-in-out;
}

.mobile-sidebar .nav-link i.fa-user-circle:hover {
    animation: spin 0.8s ease-in-out;
}

/* Shake animation */
@keyframes shake {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(-15deg); }
    50% { transform: rotate(15deg); }
    75% { transform: rotate(-15deg); }
    100% { transform: rotate(0deg); }
}

/* Spin animation */
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
  </style>
</head>

<body style="height: 100%;">

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12 p-2">
        <div class="container-fluid p-2">
          <nav class="navbar navbar-expand-lg navbar-light navbar-custom">
            <img src="{% static '.jpeg' %}" width="150" height="50" class="navbar-brand">
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'client_dashbord' %}">
                            <i class="fa-solid fa-sliders-h"></i> Panel
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'trade_list' %}">
                            <i class="fa-solid fa-signal"></i> Signals
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'client_trade_history' %}">
                            <i class="fa-solid fa-history"></i> P&L
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'fetch_and_display_orders' %}">
                            <i class="fa-brands fa-first-order-alt"></i> Broker Response
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'client_status' %}">
                            <i class="fa-solid fa-chart-line"></i> Status
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'client_help_center' %}">
                            <i class="fa-solid fa-headset"></i> Support
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'homes' %}">
                            <i class="fa-solid fa-home"></i> Home
                        </a>
                    </li>
                </ul>
            </div>
            <div class="navbar-center-icons">
                <li class="nav-item">
                    <a class="nav-link" href="#" id="notificationIcon"><i class="fa-solid fa-bell"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="profileIcon"><i class="fa-solid fa-user-circle"></i></a>
                </li>
                <li class="nav-item">
                    <button class="btn" id="brokerConnectButton">API Connect</button>
                </li>
            </div>
            <div class="burger-menu">
                <i class="fa-solid fa-bars"></i>
            </div>
        </nav>

          <!-- Notification Popup -->
          <div class="notification-popup" id="notificationPopup">
            <div class="popup-header">Notifications</div>
            <div class="popup-body" id="notificationBody">
              <p>No new notifications.</p>
            </div>
          </div>

          <!-- TradingView Widget BEGIN -->
          <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright">
              <a href="https://in.tradingview.com/" rel="noopener nofollow" target="_blank"></a>
            </div>
            <script type="text/javascript"
              src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
              {
                "symbols": [
                  {
                    "description": "",
                    "proName": "BSE:SENSEX"
                  },
                  {
                    "description": "",
                    "proName": "AMEX:SPY"
                  },
                  {
                    "description": "",
                    "proName": "BIST:XAUUSD1!"
                  },
                  {
                    "description": "",
                    "proName": "TVC:USOIL"
                  },
                  {
                    "description": "",
                    "proName": "LSE:NASD"
                  }
                ],
                "showSymbolLogo": true,
                "isTransparent": false,
                "displayMode": "adaptive",
                "colorTheme": "Light",
                "locale": "in"
              }
            </script>
          </div>
          <!-- TradingView Widget END -->

          <div class="card shadow card-custom fade-in" style="min-height: 89vh">
            <div class="card-body">
              {% block main %}
              {% endblock %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="profile-slide" id="profileSlide">
    <span class="close-slide" id="closeSlide">&times;</span>
    <div class="profile-content">
      <div class="text-center mb-4">
        <img src="{% static 'pic.png' %}" class="rounded-circle" alt="User Avatar" width="100" height="100">
      </div>
      <h5 class="modal-title text-center mb-3">Profile</h5>
      <p><strong>Name:</strong> {{ client_user.clint_name_first }} {{client_user.clint_name_last}}</p>
      <p><strong>Email:</strong> {{ client_user.clint_email }}</p>
      <p><strong>Mobile:</strong> {{ client_user.clint_phone_number }}</p>
      <p><strong>Broker:</strong> {{ client_user.broker }}</p>
      <p><strong>API Key:</strong> <span class="text-monospace">{{ client_user.api_key }}</span></p>
      <div class="d-flex justify-content-between mt-4">
        <a href="#" class="btn btn-warning btn-block mr-2">Change Password</a>
        <a href="{% url 'client_logout' %}" class="btn btn-danger btn-block ml-2">Logout</a>
      </div>
    </div>
  </div>

  <!-- Mobile Sidebar -->
  <div class="mobile-sidebar" id="mobileSidebar">
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="{% url 'client_dashbord' %}">
                <i class="fa-solid fa-sliders-h"></i> Panel
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'trade_list' %}">
                <i class="fa-solid fa-signal"></i> Levels
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'client_trade_history' %}">
                <i class="fa-solid fa-history"></i> P&L Account
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'fetch_and_display_orders' %}">
                <i class="fa-brands fa-first-order-alt"></i> Order Details
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'client_status' %}">
                <i class="fa-solid fa-chart-line"></i> Activity
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'client_help_center' %}">
                <i class="fa-solid fa-headset"></i> Support
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'homes' %}">
                <i class="fa-solid fa-home"></i> Home
            </a>
        </li>
    </ul>
</div>


  <!-- Include jQuery and Bootstrap JavaScript in the correct order -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+AiZK9Ll7/2hb7U6ka5c2e1uP4hL9F/l/71N1UnK27+q2MfRTO" crossorigin="anonymous">
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const button = document.getElementById('brokerConnectButton');

      // Check the state of the button from local storage
      if (localStorage.getItem('apiConnect') === 'on') {
        button.classList.add('on');
        button.classList.remove('off');
      } else {
        button.classList.add('off');
        button.classList.remove('on');
      }

      button.addEventListener('click', function () {
        button.classList.remove('on'); // Remove animation before redirect
        if (localStorage.getItem('apiConnect') === 'on') {
          localStorage.setItem('apiConnect', 'off');
          button.classList.add('off');
          button.classList.remove('on');
          window.location.href = "{% url 'off' %}";
        } else {
          localStorage.setItem('apiConnect', 'on');
          button.classList.add('on');
          button.classList.remove('off');
          window.location.href = "{% url 'redirect_to_smartapi_login' %}";
        }
      });

      // Listen for storage changes to update the button state
      window.addEventListener('storage', function () {
        if (localStorage.getItem('apiConnect') === 'on') {
          button.classList.add('on');
          button.classList.remove('off');
        } else {
          button.classList.add('off');
          button.classList.remove('on');
        }
      });

      const notificationIcon = document.getElementById('notificationIcon');
      const notificationPopup = document.getElementById('notificationPopup');
      const notificationBody = document.getElementById('notificationBody');

      notificationIcon.addEventListener('click', function () {
        notificationPopup.style.display = notificationPopup.style.display === 'block' ? 'none' : 'block';
        if (notificationPopup.style.display === 'block') {
          fetchNotifications();
        }
      });

      function fetchNotifications() {
        fetch('/get-notifications/')
          .then(response => response.json())
          .then(data => {
            notificationBody.innerHTML = '';
            data.forEach(notification => {
              const p = document.createElement('p');
              p.textContent = `${notification.message} - ${new Date(notification.created_at).toLocaleString()}`;
              notificationBody.appendChild(p);
            });
          });
      }

      // Close the popup when clicking outside
      document.addEventListener('click', function (event) {
        if (!notificationIcon.contains(event.target) && !notificationPopup.contains(event.target)) {
          notificationPopup.style.display = 'none';
        }
      });

      // Handle profile slide
      const profileIcon = document.getElementById('profileIcon');
      const profileSlide = document.getElementById('profileSlide');
      const closeSlide = document.getElementById('closeSlide');

      profileIcon.addEventListener('click', function () {
        profileSlide.classList.add('open');
      });

      closeSlide.addEventListener('click', function () {
        profileSlide.classList.remove('open');
      });

      // Close the profile slide when clicking outside
      document.addEventListener('click', function (event) {
        if (!profileIcon.contains(event.target) && !profileSlide.contains(event.target)) {
          profileSlide.classList.remove('open');
        }
      });

      // Handle burger menu and mobile sidebar
      const burgerMenu = document.querySelector('.burger-menu');
      const mobileSidebar = document.querySelector('.mobile-sidebar');

      burgerMenu.addEventListener('click', function () {
        mobileSidebar.classList.toggle('open');
      });
    });
  </script>
</body>

</html>